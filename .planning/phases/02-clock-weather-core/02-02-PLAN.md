---
phase: 02-clock-weather-core
plan: 02
type: execute
wave: 2
depends_on: ["02-01"]
files_modified:
  - src/components/weather/CurrentWeather.tsx
  - src/components/weather/SunTimes.tsx
  - src/components/weather/WeatherIcon.tsx
  - src/components/layout/Header.tsx
  - src/App.tsx
autonomous: false
requirements: [CLKW-02, CLKW-04]

must_haves:
  truths:
    - "Current temperature and weather condition icon display in the header"
    - "Sunrise and sunset times display in the header next to current weather"
    - "Weather data refreshes every 15 minutes without page reload"
    - "Loading and error states display gracefully when weather unavailable"
    - "Weather placeholder card removed from main content area"
  artifacts:
    - path: "src/components/weather/CurrentWeather.tsx"
      provides: "Current temp, icon, and condition description"
      exports: ["CurrentWeather"]
    - path: "src/components/weather/SunTimes.tsx"
      provides: "Sunrise and sunset time display"
      exports: ["SunTimes"]
    - path: "src/components/weather/WeatherIcon.tsx"
      provides: "WMO code to react-icon component mapper"
      exports: ["WeatherIcon"]
  key_links:
    - from: "src/components/weather/CurrentWeather.tsx"
      to: "src/hooks/useWeather.ts"
      via: "useWeather() hook call"
      pattern: "useWeather"
    - from: "src/components/weather/WeatherIcon.tsx"
      to: "src/lib/utils/weatherCodes.ts"
      via: "getWeatherInfo(code)"
      pattern: "getWeatherInfo"
    - from: "src/components/layout/Header.tsx"
      to: "src/components/weather/CurrentWeather.tsx"
      via: "component in header right side"
      pattern: "<CurrentWeather"
---

<objective>
Build current weather and sunrise/sunset UI components and wire them into the header alongside the clock. Remove the Weather placeholder card from main content.

Purpose: Put current conditions at a glance in the header bar (clock/date on left, weather/sun on right). The 7-day forecast hi/lo will be integrated into calendar days in Phase 3 — no standalone forecast card needed.

Output: Header shows clock + date on left, current weather + sunrise/sunset on right. Weather placeholder card removed from main content area. useWeather hook's daily data remains available for Phase 3 calendar integration.
</objective>

<execution_context>
@/Users/joshua/.claude/get-shit-done/workflows/execute-plan.md
@/Users/joshua/.claude/get-shit-done/templates/summary.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/ROADMAP.md
@.planning/STATE.md
@.planning/phases/02-clock-weather-core/02-RESEARCH.md
@.planning/phases/02-clock-weather-core/02-01-SUMMARY.md
@src/App.tsx
@src/index.css
@src/components/layout/Header.tsx
@src/lib/constants.ts
</context>

<tasks>

<task type="auto">
  <name>Task 1: Create WeatherIcon, CurrentWeather, and SunTimes components</name>
  <files>
    src/components/weather/WeatherIcon.tsx
    src/components/weather/CurrentWeather.tsx
    src/components/weather/SunTimes.tsx
  </files>
  <action>
    Create `src/components/weather/WeatherIcon.tsx`:
    - Props: `{ code: number; className?: string; size?: string }`
    - Import weather icons from `react-icons/wi`: WiDaySunny, WiDayCloudy, WiCloudy, WiFog, WiSprinkle, WiRain, WiRainWind, WiRainMix, WiSnow, WiShowers, WiThunderstorm, WiStormShowers, WiNa
    - Create a Record mapping icon string names (from weatherCodes.ts getWeatherInfo) to React icon components
    - Use `getWeatherInfo(code)` to look up the icon name, then render the mapped component
    - Default to WiNa for unknown codes
    - Pass className and size through to the icon component

    Create `src/components/weather/CurrentWeather.tsx`:
    - Uses `useWeather()` hook
    - Wrapped in `React.memo` to prevent re-renders from clock (per research pitfall 1)
    - Layout: horizontal flex with icon on left, temp + description on right
    - Designed to sit in the header — keep it compact
    - Temperature: `Math.round(data.current.temperature_2m)` with "°C" suffix
    - Use `WeatherIcon` component with the current weather code
    - Temperature text: fluid size `clamp(1.5rem, 3vw, 3rem)`, font-bold, tabular-nums
    - Description text: smaller, text-text-secondary
    - Loading state: subtle "Loading..." in text-text-secondary
    - Error state: "Weather unavailable" in text-text-secondary (graceful degradation)

    Create `src/components/weather/SunTimes.tsx`:
    - Uses `useWeather()` hook
    - Wrapped in `React.memo`
    - Shows today's sunrise and sunset (index 0 from daily arrays)
    - Format times using `formatInTimeZone` or parse the ISO string and format as `HH:mm`
    - Layout: compact horizontal with sunrise icon (WiSunrise from react-icons/wi) + time, sunset icon (WiSunset) + time
    - Designed to sit in the header next to CurrentWeather — keep compact
    - Use text-text-secondary for labels, text-accent-gold for the sun icons
    - Loading/error: return null

    NOTE: No WeatherForecast component in this phase. The 7-day forecast hi/lo will be integrated into calendar day rows in Phase 3, using the useWeather hook's daily data directly.
  </action>
  <verify>
    Run `npm run build` — all 3 components compile without TypeScript errors.
    Verify files exist: `ls src/components/weather/WeatherIcon.tsx src/components/weather/CurrentWeather.tsx src/components/weather/SunTimes.tsx`
  </verify>
  <done>
    Three weather components created: WeatherIcon maps WMO codes to react-icons, CurrentWeather shows temp + icon + description, SunTimes shows sunrise/sunset. All use useWeather hook and are wrapped in React.memo. Build passes.
  </done>
</task>

<task type="auto">
  <name>Task 2: Wire CurrentWeather and SunTimes into Header, remove Weather placeholder from App</name>
  <files>
    src/components/layout/Header.tsx
    src/App.tsx
  </files>
  <action>
    Update `src/components/layout/Header.tsx`:
    - Header layout: left side = clock/date (existing), right side = current weather + sunrise/sunset
    - The header already uses `flex items-center justify-between`
    - Right side: a flex container with CurrentWeather and SunTimes stacked or side-by-side
    - Suggested layout for right side: vertical stack with CurrentWeather (temp + icon) on top, SunTimes (sunrise/sunset) below, right-aligned
    - On mobile, the right side should scale down gracefully — smaller icon/font sizes via clamp()
    - Import CurrentWeather and SunTimes components

    Update `src/App.tsx`:
    - Remove the Weather placeholder card entirely from main content area:
      Remove: `<div className="card-glass ..."><span className="text-text-secondary text-lg">Weather</span></div>`
    - Keep the Calendar placeholder card (it will later show day+date+weather in Phase 3)
    - The main content area will have just the Calendar card (which takes more vertical space now)
  </action>
  <verify>
    Run `npm run build` — no errors. Run `npm run dev` and verify:
    - Header shows clock/date on left, current weather + sunrise/sunset on right
    - No separate weather card in main content area
    - Calendar placeholder takes full main content space
    - On mobile viewport, header weather scales down but remains readable
    - Weather data loads after brief loading state
    - No console errors
  </verify>
  <done>
    Header shows clock/date on left and current weather + sunrise/sunset on right. Weather placeholder card removed from main content. Calendar placeholder now has full main area. Layout is responsive.
  </done>
</task>

<task type="checkpoint:human-verify" gate="blocking">
  <name>Task 3: Verify clock and weather header display</name>
  <files>src/App.tsx</files>
  <action>
Human verification checkpoint. What was built:
- Real-time Berlin clock with date-fns-tz formatting (upgraded from Intl API)
- Current weather (temperature + icon + description) in header right side
- Sunrise and sunset times in header right side below current weather
- Weather placeholder card removed from main content area
- Auto-refreshing weather data via React Query (5-min stale, 15-min refetch)
- 7-day forecast data available via useWeather hook for Phase 3 calendar integration

How to verify:
1. Run `npm run dev` and open http://localhost:5173/family-dashboard/
2. Verify clock shows current Berlin time and updates every second
3. Verify date shows in English format (e.g., "Monday, February 16, 2026")
4. Verify current weather appears in the header right side with temperature and icon
5. Verify sunrise and sunset times display in header right side
6. Verify NO separate weather card exists in main content area
7. Open Chrome DevTools, switch to iPhone viewport — verify header layout scales down
8. Open Network tab — confirm fetch to api.open-meteo.com returns 200
9. Wait 1 minute — verify no console errors or memory warnings
  </action>
  <verify>User confirms clock accuracy, weather in header, no weather card in main area, responsive layout, and overall visual quality</verify>
  <done>Clock shows Berlin time, header shows current weather + sunrise/sunset on right side, no separate weather card, layout works on kiosk and mobile viewports, user approves visual quality</done>
</task>

</tasks>

<verification>
1. `npm run build` completes without errors
2. Clock shows Berlin time, ticks every second
3. Header right side shows current temperature + weather icon from Open-Meteo
4. Header right side shows sunrise/sunset times for Berlin
5. No separate weather card in main content area
6. Weather refreshes automatically (visible in Network tab after 15 minutes)
7. Layout works in both landscape (kiosk) and portrait (mobile) viewports
8. No console errors
9. Loading states display gracefully before weather data arrives
</verification>

<success_criteria>
- Header left: clock + date in Berlin timezone
- Header right: current weather (temp + icon + description) + sunrise/sunset times
- No standalone weather card in main content area
- Weather data refreshes every 15 minutes via React Query
- All components wrapped in React.memo to prevent clock re-render cascade
- Layout responsive on both kiosk (landscape) and mobile (portrait) viewports
- Graceful loading and error states
- useWeather hook exposes 7-day daily data for Phase 3 calendar integration
</success_criteria>

<output>
After completion, create `.planning/phases/02-clock-weather-core/02-02-SUMMARY.md`
</output>
