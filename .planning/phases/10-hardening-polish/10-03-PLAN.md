---
phase: 10-hardening-polish
plan: 03
type: execute
wave: 2
depends_on: [10-01, 10-02]
files_modified:
  - src/index.css
  - src/lib/constants.ts
autonomous: true
requirements: [DISP-03, DISP-01]

must_haves:
  truths:
    - "No backdrop-filter blur on always-visible kiosk elements (Pi GPU optimization)"
    - "Timer pulse animation uses opacity instead of background-color for compositing efficiency"
    - "All CSS animations use only transform and opacity properties (compositing-only)"
    - "Build output is verified clean with no warnings"
  artifacts:
    - path: "src/index.css"
      provides: "Pi-optimized CSS without GPU-expensive compositing"
      contains: "card-glass"
    - path: "src/lib/constants.ts"
      provides: "Memory watchdog constants for documentation"
  key_links:
    - from: "src/index.css"
      to: "card-glass class"
      via: "Removal of backdrop-filter for Pi performance"
      pattern: "card-glass"
---

<objective>
Optimize CSS and animations for smooth Raspberry Pi performance and verify the full hardened build.

Purpose: The Pi has limited GPU memory (128-256MB shared). backdrop-filter creates compositing layers that consume GPU resources. Animations that trigger paint (background-color) are expensive. This plan removes GPU bottlenecks and verifies the complete hardened build.
Output: Pi-optimized CSS, efficient animations, and a clean production build.
</objective>

<execution_context>
@/Users/joshua/.claude/get-shit-done/workflows/execute-plan.md
@/Users/joshua/.claude/get-shit-done/templates/summary.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/ROADMAP.md
@.planning/STATE.md
@.planning/phases/10-hardening-polish/10-RESEARCH.md
@src/index.css
@src/lib/constants.ts
</context>

<tasks>

<task type="auto">
  <name>Task 1: Remove GPU-expensive CSS and optimize animations for Pi</name>
  <files>src/index.css</files>
  <action>
    1. Update `.card-glass` class:
       - REMOVE `-webkit-backdrop-filter: blur(8px)` and `backdrop-filter: blur(8px)`
       - Keep `background: rgba(255, 255, 255, 0.05)`, `border-radius: 1rem`, and `border: 1px solid rgba(255, 255, 255, 0.08)`
       - Add a CSS comment: `/* backdrop-filter removed: GPU compositing too expensive for Pi kiosk */`
       - The visual difference on a dark background with 5% alpha is imperceptible — blur has no visible effect

    2. Optimize `@keyframes timer-pulse` animation:
       - Current: animates `background-color` (triggers paint every frame)
       - Replace with an opacity-based approach using a pseudo-element or just animate opacity:
         ```css
         @keyframes timer-pulse {
           0%, 100% { opacity: 0.6; }
           50% { opacity: 1; }
         }
         ```
       - Update `.timer-alert-pulse` to use a static `background-color: rgba(255, 215, 0, 0.25)` and apply the opacity animation
       - This moves the animation to the compositor thread (GPU-friendly, no paint)

    3. Verify `@keyframes sidebar-fade-in` already uses only `opacity` — it does, so no change needed.

    4. Add a `@media (prefers-reduced-motion: reduce)` block at the end of the file:
       ```css
       @media (prefers-reduced-motion: reduce) {
         .timer-alert-pulse,
         .sidebar-priority-enter,
         .sidebar-rotation-enter {
           animation: none;
         }
       }
       ```
       This is good practice for accessibility and also allows the Pi kiosk to disable animations entirely if needed via Chromium flags.

    5. Scan for any other `will-change`, `backdrop-filter`, or `filter` properties in the file. If found, evaluate and remove unnecessary ones. Based on current file content, only `.card-glass` has backdrop-filter.
  </action>
  <verify>Run `npm run build` — build succeeds. Grep `src/index.css` for `backdrop-filter` — should only appear in the comment, not as an active property.</verify>
  <done>No backdrop-filter blur on any always-visible element. Timer pulse uses opacity (compositor-only). Reduced-motion media query respects accessibility preferences. All animations are GPU-friendly.</done>
</task>

<task type="auto">
  <name>Task 2: Add hardening constants and run final build verification</name>
  <files>src/lib/constants.ts</files>
  <action>
    1. Add memory watchdog constants to `src/lib/constants.ts` for centralized configuration:
       ```typescript
       // Memory watchdog (Chromium-only)
       export const MEMORY_CHECK_INTERVAL_MS = 5 * 60_000; // 5 minutes
       export const MEMORY_THRESHOLD_PERCENT = 80; // Force reload above this

       // Auto-refresh backup check
       export const REFRESH_BACKUP_INTERVAL_MS = 15 * 60_000; // 15 minutes
       ```

    2. Run `npm run build` and verify:
       - Build completes with no TypeScript errors
       - No warnings about missing types or unused imports
       - Output bundle exists in `dist/`

    3. Run `npm run lint` and fix any lint errors introduced by Phase 10 changes.

    4. Log the build output size for reference (documented in SUMMARY).
  </action>
  <verify>Run `npm run build && npm run lint` — both pass clean. Check `ls -la dist/assets/` shows reasonable bundle sizes.</verify>
  <done>Constants centralized. Build passes clean. Lint passes clean. Production bundle is ready for deployment.</done>
</task>

</tasks>

<verification>
- `npm run build` succeeds with no errors or warnings
- `npm run lint` passes clean
- `grep "backdrop-filter" src/index.css` shows only comment references
- `grep "prefers-reduced-motion" src/index.css` confirms accessibility media query
- dist/ contains production-ready output
</verification>

<success_criteria>
- All backdrop-filter blur removed from always-visible elements
- Timer animation uses compositor-only properties (opacity/transform)
- Reduced-motion media query added for accessibility
- Constants centralized for memory watchdog and backup refresh
- Full build and lint pass clean
</success_criteria>

<output>
After completion, create `.planning/phases/10-hardening-polish/10-03-SUMMARY.md`
</output>
