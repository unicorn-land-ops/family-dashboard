---
phase: 01-foundation-setup
plan: 02
type: execute
wave: 2
depends_on:
  - 01-01
files_modified:
  - src/components/layout/DashboardShell.tsx
  - src/components/layout/Header.tsx
  - src/components/layout/StatusBar.tsx
  - src/hooks/useAutoRefresh.ts
  - src/hooks/useViewport.ts
  - src/lib/constants.ts
  - src/App.tsx
  - src/index.css
autonomous: false
requirements:
  - DISP-01
  - DISP-02
  - DISP-03
  - DISP-06

must_haves:
  truths:
    - "Dashboard fills the full screen in landscape on a 1920x1080 display without scrollbars"
    - "Dashboard fills the full screen in portrait on a 390x844 display without scrollbars"
    - "Layout switches between two-column (landscape) and single-column (portrait) based on orientation"
    - "Text is readable at 2 meters on the kiosk display (large fluid typography)"
    - "Text is readable at arm's length on mobile (normal fluid typography)"
    - "Visual design has dark gradient background, clean Inter font, and modern card surfaces"
    - "Page auto-reloads at 3am Berlin time to prevent memory accumulation"
    - "All useEffect hooks have cleanup functions for timers and listeners"
  artifacts:
    - path: "src/components/layout/DashboardShell.tsx"
      provides: "Responsive CSS Grid shell with landscape/portrait layouts"
      contains: "grid-template-areas"
    - path: "src/components/layout/Header.tsx"
      provides: "Top bar with placeholder clock and status area"
      min_lines: 15
    - path: "src/components/layout/StatusBar.tsx"
      provides: "Bottom status bar showing connection/refresh info"
      min_lines: 10
    - path: "src/hooks/useAutoRefresh.ts"
      provides: "3am Berlin time page reload with cleanup"
      contains: "clearTimeout"
    - path: "src/hooks/useViewport.ts"
      provides: "Viewport detection hook (kiosk vs mobile)"
      contains: "matchMedia"
    - path: "src/lib/constants.ts"
      provides: "Shared constants for breakpoints, colors, intervals"
      contains: "BREAKPOINT"
    - path: "src/App.tsx"
      provides: "Root component wiring shell, header, status bar, and auto-refresh"
      contains: "useAutoRefresh"
  key_links:
    - from: "src/App.tsx"
      to: "src/hooks/useAutoRefresh.ts"
      via: "Hook invocation in root component"
      pattern: "useAutoRefresh\\(\\)"
    - from: "src/App.tsx"
      to: "src/components/layout/DashboardShell.tsx"
      via: "Component render"
      pattern: "<DashboardShell"
    - from: "src/components/layout/DashboardShell.tsx"
      to: "src/lib/constants.ts"
      via: "Breakpoint constants"
      pattern: "import.*constants"
---

<objective>
Build the responsive layout shell with CSS Grid, fluid typography, placeholder content areas, and the auto-refresh mechanism for 24/7 operation.

Purpose: Create the visual foundation that all content panels (weather, calendar, transit, etc.) will be placed into in subsequent phases. Establishes the responsive behavior between kiosk (landscape) and mobile (portrait) and the memory safety mechanism.

Output: A polished, responsive dashboard shell with modern dark design, fluid typography, header/main/sidebar/status grid areas, and auto-refresh hook.
</objective>

<execution_context>
@/Users/joshua/.claude/get-shit-done/workflows/execute-plan.md
@/Users/joshua/.claude/get-shit-done/templates/summary.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/ROADMAP.md
@.planning/STATE.md
@.planning/phases/01-foundation-setup/01-RESEARCH.md
@.planning/phases/01-foundation-setup/01-01-SUMMARY.md
</context>

<tasks>

<task type="auto">
  <name>Task 1: Create responsive DashboardShell, Header, StatusBar, and constants</name>
  <files>
    src/components/layout/DashboardShell.tsx
    src/components/layout/Header.tsx
    src/components/layout/StatusBar.tsx
    src/hooks/useViewport.ts
    src/lib/constants.ts
    src/index.css
  </files>
  <action>
1. Create `src/lib/constants.ts` with shared configuration:
   - `BREAKPOINT_MOBILE = 768` (px, below this = portrait/mobile layout)
   - `RELOAD_HOUR = 3` (3am Berlin time)
   - `TIMEZONE = 'Europe/Berlin'`
   - Color constants matching the `@theme` values in index.css (for any JS usage)

2. Create `src/hooks/useViewport.ts`:
   - Returns `{ isMobile: boolean, isLandscape: boolean }`
   - Uses `window.matchMedia('(max-width: 768px) and (orientation: portrait)')` for mobile detection
   - Listens for changes via `matchMedia.addEventListener('change', ...)`
   - MUST have cleanup in useEffect (removeEventListener)
   - Export the hook as named export

3. Create `src/components/layout/DashboardShell.tsx`:
   - CSS Grid layout using Tailwind classes
   - Landscape (default): two-column grid with `grid-template-areas: 'header header' 'main sidebar' 'status status'`, columns `1fr 380px`, rows `auto 1fr auto`
   - Portrait (mobile): single-column grid with `grid-template-areas: 'header' 'main' 'status'`, sidebar hidden
   - Use `h-dvh w-screen overflow-hidden` for full viewport
   - Use `clamp()` for padding and gap (e.g., `p-[clamp(12px,1.5vw,24px)]`, `gap-[clamp(10px,1vw,20px)]`)
   - Children are placed into named grid areas via CSS classes
   - Implement using Tailwind responsive prefixes or a CSS class in index.css with media query — whichever produces cleaner code. The research shows Tailwind arbitrary values for grid-template-areas can be messy, so a CSS class in index.css with media query is acceptable.

4. Create `src/components/layout/Header.tsx`:
   - Grid area: header
   - Contains a placeholder clock showing current time (using `new Date().toLocaleTimeString('de-DE', { timeZone: 'Europe/Berlin' })` with `setInterval` every second and proper cleanup)
   - Contains placeholder date display
   - Fluid typography: time uses `clamp(2rem, 6vw, 6rem)` font-size, date uses `clamp(0.875rem, 1.2vw, 1.25rem)`
   - Font-weight: 200 for time (ultra-light for modern look), 400 for date
   - Style: clean, minimal, no borders. The time should be the hero element.

5. Create `src/components/layout/StatusBar.tsx`:
   - Grid area: status
   - Shows "Last refresh: {timestamp}" text
   - Shows a subtle "Family Dashboard" label
   - Small text, low opacity (text-secondary color)
   - Font size: `clamp(0.65rem, 0.8vw, 0.85rem)`

6. Update `src/index.css` — add CSS Grid layout rules if using a CSS class approach for the grid template areas (cleaner than Tailwind arbitrary values for complex grids). Add any needed utility classes. Ensure `-webkit-backdrop-filter` prefix is included alongside `backdrop-filter` for Safari.

The visual design should feel premium: dark gradient background (already in index.css from Plan 01), generous whitespace, clean Inter typography, subtle glass-morphism card surfaces using `backdrop-filter: blur()` with semi-transparent backgrounds.

For placeholder content in the main and sidebar areas, create simple "card" divs with:
- Semi-transparent background: `bg-white/5`
- Rounded corners: `rounded-2xl`
- Backdrop blur: `backdrop-blur-sm` (with `-webkit-backdrop-filter` fallback)
- Placeholder text indicating what will go there (e.g., "Weather", "Calendar", "Transit")
- These serve as visual scaffolding showing the grid works
  </action>
  <verify>
Run `npm run build` — must succeed.
Run `npm run dev` — visual inspection that:
- Dark gradient background fills screen
- Clock displays and updates every second
- Grid shows header at top, main content area, sidebar on right (landscape), status at bottom
- Text uses Inter font
- Resize browser to 390px wide — layout switches to single column, sidebar disappears
  </verify>
  <done>
DashboardShell renders a responsive CSS Grid layout. In landscape, it shows a two-column layout with header, main, sidebar, and status areas. In portrait/mobile, it collapses to a single column. Header shows a live clock with fluid typography. Placeholder cards indicate future content areas. StatusBar shows refresh info.
  </done>
</task>

<task type="auto">
  <name>Task 2: Create useAutoRefresh hook and wire everything into App.tsx</name>
  <files>
    src/hooks/useAutoRefresh.ts
    src/App.tsx
  </files>
  <action>
1. Create `src/hooks/useAutoRefresh.ts` using the pattern from RESEARCH.md:
   - Calculate milliseconds until next 3am Berlin time
   - Set `setTimeout` for page reload at that time
   - Add `visibilitychange` listener that logs when page becomes visible (future: trigger data refresh)
   - MUST return cleanup function that clears timeout AND removes event listener
   - Use constants from `src/lib/constants.ts` for RELOAD_HOUR and TIMEZONE
   - Add `console.log('[AutoRefresh] Scheduled reload in X hours')` on mount for debugging

2. Update `src/App.tsx` to wire everything together:
   - Import and call `useAutoRefresh()` at the top of the component
   - Render `<DashboardShell>` as the root layout
   - Inside DashboardShell, render:
     - `<Header />` in the header grid area
     - Main content area with 2-3 placeholder cards (Weather placeholder, Calendar placeholder)
     - Sidebar area with 2-3 placeholder cards (Transit placeholder, Horoscopes placeholder) — only visible in landscape
     - `<StatusBar />` in the status grid area
   - Each placeholder card should be a simple div with glass-morphism styling and a label

3. Ensure EVERY useEffect in the entire codebase has a cleanup function:
   - Header.tsx clock interval → clearInterval
   - useAutoRefresh.ts timeout → clearTimeout
   - useAutoRefresh.ts visibilitychange → removeEventListener
   - useViewport.ts matchMedia → removeEventListener

This is critical for DISP-06 (24/7 memory leak prevention).
  </action>
  <verify>
Run `npm run build` — must succeed.
Run `npm run dev` and check browser console:
- "[AutoRefresh] Scheduled reload in X hours" message appears
- No React Strict Mode warnings about missing cleanup
- No console errors
Open React DevTools (if available) and confirm no mounting/unmounting loops.
  </verify>
  <done>
useAutoRefresh hook schedules a 3am Berlin time page reload with proper cleanup. App.tsx renders the complete dashboard shell with all layout components wired together. Every useEffect has a cleanup function. Console shows auto-refresh scheduling on mount.
  </done>
</task>

<task type="checkpoint:human-verify" gate="blocking">
  <name>Task 3: Verify responsive layout and visual design</name>
  <files>src/App.tsx</files>
  <action>
Human verification checkpoint. What was built:
- CSS Grid layout switching between landscape (2-column) and portrait (1-column)
- Live clock with fluid typography in the header
- Placeholder content cards with glass-morphism styling
- Dark gradient background with Inter font
- Auto-refresh mechanism (check console for scheduling message)

Steps to verify:
1. Run `npm run dev` and open in browser
2. **Landscape check (simulating kiosk):** Resize browser to 1920x1080 or wider
   - Verify: Two-column layout with header spanning full width, main content left, sidebar right, status bar at bottom
   - Verify: Clock displays large and updates every second
   - Verify: Dark gradient background, Inter font, placeholder cards visible
   - Verify: No scrollbars, content fills viewport
3. **Portrait check (simulating mobile):** Resize browser to 390px wide (or use Chrome DevTools iPhone mode)
   - Verify: Single-column layout, sidebar hidden
   - Verify: Text is readable size, not tiny
   - Verify: No horizontal scroll, no content overflow
4. **Console check:** Open browser DevTools console
   - Verify: "[AutoRefresh] Scheduled reload in X hours" message present
   - Verify: No React warnings or errors
5. **Visual quality:** Does the design feel modern and polished? Clean typography, good spacing, subtle card surfaces?

Resume signal: Type "approved" or describe any visual/layout issues to fix.
  </action>
  <verify>User confirms visual quality and responsive behavior are acceptable.</verify>
  <done>Human has verified that the dashboard layout renders correctly in both landscape and portrait, with modern visual design and no console errors.</done>
</task>

</tasks>

<verification>
1. `npm run build` succeeds
2. `npm run dev` renders the dashboard with correct layout
3. Landscape: 2-column grid with header, main, sidebar, status
4. Portrait (390px): single-column, no sidebar, no overflow
5. Clock updates every second in header
6. Dark gradient background with Inter font
7. Console shows auto-refresh scheduling, no warnings
8. All useEffect hooks have cleanup functions
9. Placeholder cards visible with glass-morphism styling
</verification>

<success_criteria>
- Dashboard fills viewport without scrollbars in both landscape and portrait
- Layout responsive: 2-column at 1920px, 1-column at 390px
- Visual design is modern: dark gradient, Inter font, glass cards, fluid typography
- Auto-refresh scheduled for 3am Berlin time with cleanup
- No memory leak patterns (all effects cleaned up)
- Human verification approves visual quality
</success_criteria>

<output>
After completion, create `.planning/phases/01-foundation-setup/01-02-SUMMARY.md`
</output>
