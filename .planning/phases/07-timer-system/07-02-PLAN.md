---
phase: 07-timer-system
plan: 02
type: execute
wave: 2
depends_on: ["07-01"]
files_modified:
  - src/components/timer/TimerPanel.tsx
  - src/components/timer/TimerCard.tsx
  - src/components/timer/TimerInput.tsx
  - src/components/timer/TimerAlert.tsx
autonomous: true
requirements: [TIMR-01, TIMR-02, TIMR-03, TIMR-04, TIMR-05]

must_haves:
  truths:
    - "User can enter a label and select a duration to create a timer"
    - "Each active timer displays its label and countdown in MM:SS format"
    - "Completed timers show a flashing alert with dismiss button and play sound"
    - "User can cancel a running timer"
    - "Multiple timers render independently in a scrollable list"
    - "Compact variant shows active timers in wall sidebar style"
  artifacts:
    - path: "src/components/timer/TimerPanel.tsx"
      provides: "Full (mobile) and compact (wall sidebar) timer views with single useInterval tick"
      exports: ["TimerPanel"]
    - path: "src/components/timer/TimerCard.tsx"
      provides: "Individual timer display with countdown, progress, cancel button"
      exports: ["TimerCard"]
    - path: "src/components/timer/TimerInput.tsx"
      provides: "Duration picker with preset buttons and custom input"
      exports: ["TimerInput"]
    - path: "src/components/timer/TimerAlert.tsx"
      provides: "Completion overlay with flash animation, sound trigger, dismiss"
      exports: ["TimerAlert"]
  key_links:
    - from: "src/components/timer/TimerPanel.tsx"
      to: "src/hooks/useTimers.ts"
      via: "useTimers hook consumption"
      pattern: "useTimers\\(\\)"
    - from: "src/components/timer/TimerPanel.tsx"
      to: "src/hooks/useInterval.ts"
      via: "single 1s tick driving all countdowns"
      pattern: "useInterval.*1000"
    - from: "src/components/timer/TimerAlert.tsx"
      to: "src/lib/sounds.ts"
      via: "playTimerAlert on completion"
      pattern: "playTimerAlert"
---

<objective>
Create all timer UI components: TimerPanel (full + compact variants), TimerCard (countdown display), TimerInput (duration picker), and TimerAlert (completion notification).

Purpose: Provides the visual interface for creating, monitoring, and dismissing timers. Follows GroceryPanel pattern with full (mobile) and compact (wall sidebar) variants.
Output: src/components/timer/TimerPanel.tsx, TimerCard.tsx, TimerInput.tsx, TimerAlert.tsx
</objective>

<execution_context>
@/Users/joshua/.claude/get-shit-done/workflows/execute-plan.md
@/Users/joshua/.claude/get-shit-done/templates/summary.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/ROADMAP.md
@.planning/STATE.md
@.planning/phases/07-timer-system/07-RESEARCH.md
@.planning/phases/07-timer-system/07-01-SUMMARY.md

@src/hooks/useTimers.ts
@src/hooks/useInterval.ts
@src/lib/sounds.ts
@src/components/grocery/GroceryPanel.tsx
@src/components/grocery/GroceryInput.tsx
@src/types/database.ts
@src/index.css
</context>

<tasks>

<task type="auto">
  <name>Task 1: Create TimerInput and TimerCard components</name>
  <files>src/components/timer/TimerInput.tsx, src/components/timer/TimerCard.tsx</files>
  <action>
**src/components/timer/TimerInput.tsx** — Duration picker for creating timers.

Props: `{ onAdd: (label: string, durationSeconds: number) => void }`

Layout (mobile-friendly, touch targets):
- Text input for timer label (placeholder "Timer label...", defaults to "Timer" if empty on submit)
- Row of preset duration buttons: 1m (60), 3m (180), 5m (300), 10m (600), 15m (900), 30m (1800). Each button styled as a pill/chip with `card-glass` background. Tapping a preset immediately creates the timer with the current label.
- Custom duration: number input (type="number", min=1, placeholder="min") + "Start" button. Converts minutes to seconds on submit.
- Style: Use Tailwind classes matching grocery input style. Preset buttons in a flex-wrap row with gap-2. Each preset ~44px min-height for touch. Active/hover state uses accent-gold.
- Clear label input after successful submit.

**src/components/timer/TimerCard.tsx** — Single timer display.

Props: `{ timer: Timer, remaining: number, onCancel: () => void, onDismiss: () => void }`

Layout:
- Top row: timer label (left), cancel button X (right, only when `remaining > 0`).
- Center: Large countdown display using `formatCountdown(remaining)` from useTimers. Use `tabular-nums` font-variant for stable digits. Text size: `text-2xl` for compact, `text-4xl` for full.
- Bottom: Linear progress bar showing `getTimerProgress(timer)`. Bar fills left-to-right from accent-gold. Background is white/10. Height 4px, rounded.
- When `remaining <= 0`: card background pulses (use CSS animation, see index.css additions). Show "Done!" text. Hide cancel button.
- Style: `card-glass` wrapper with padding. Margin-bottom between cards.

Import `formatCountdown`, `getTimerProgress`, `getRemainingSeconds` from `'../../hooks/useTimers'`. Import `Timer` from `'../../types/database'`.
  </action>
  <verify>Run `npx tsc --noEmit` — zero type errors on both components.</verify>
  <done>TimerInput renders preset buttons and custom input. TimerCard renders countdown with progress bar and cancel button. Both compile cleanly.</done>
</task>

<task type="auto">
  <name>Task 2: Create TimerAlert and TimerPanel components, add CSS animations</name>
  <files>src/components/timer/TimerAlert.tsx, src/components/timer/TimerPanel.tsx, src/index.css</files>
  <action>
**src/components/timer/TimerAlert.tsx** — Completion alert for a finished timer.

Props: `{ timer: Timer, onDismiss: () => void }`

Behavior:
- On mount, call `playTimerAlert()` from `'../../lib/sounds'`. Use a `useEffect` with the timer ID as dependency. Track alerted timer IDs in a module-level `Set<string>` to prevent re-firing: only call `playTimerAlert()` if the timer ID is NOT already in the set, then add it. Export a `clearAlertedTimer(id: string)` function that removes from the set (called by TimerPanel on dismiss).
- Display: Card with `timer-alert-pulse` CSS class (pulsing amber/gold background). Shows timer label, "Time's up!" text, and a large "Dismiss" button.
- Dismiss button: calls `onDismiss`, which should trigger `dismissTimer(id)` from the hook.
- Style: Prominent, eye-catching. Use amber/gold tones. Dismiss button is full-width, tall (min-h-[48px]), accent-gold background with dark text.

**src/components/timer/TimerPanel.tsx** — Main panel with full and compact variants. Mirrors GroceryPanel pattern.

Props: `{ variant?: 'full' | 'compact' }`

Internal state:
- Uses `useTimers()` hook for all data and mutations.
- Uses `useInterval(() => setTick(t => t + 1), hasTimers ? 1000 : null)` for a SINGLE 1-second interval that forces re-render for all countdown displays. `hasTimers` is true when `timers.length > 0`. The `tick` state is only used to trigger re-renders; the actual countdown values come from `getRemainingSeconds`.

**Compact variant** (wall sidebar):
- Header: "Timers (N)" where N is `activeCount`.
- List active timers as small TimerCard components (text-lg countdown size).
- Show completed timers as TimerAlert components.
- Max height `max-h-[400px]` with overflow scroll, `scrollbar-hide`.
- Wrapped in `card-glass p-4`.

**Full variant** (mobile):
- If `!supabaseEnabled`: show "Connect Supabase to use timers" message (same pattern as GroceryPanel).
- Header: "Timers (N)" with activeCount.
- Scrollable timer list area (flex-1, overflow-y-auto): active timers as TimerCard, completed timers as TimerAlert.
- Empty state: "No active timers" centered text in white/30.
- Sticky bottom: TimerInput component.
- Layout: `flex flex-col h-full` matching GroceryPanel structure.

On dismiss: call both `dismissTimer(id)` from hook AND `clearAlertedTimer(id)` from TimerAlert module.

**src/index.css** — Add timer-specific CSS animation at the end of the file:

```css
/* Timer alert pulse animation */
@keyframes timer-pulse {
  0%, 100% { background-color: rgba(255, 215, 0, 0.15); }
  50% { background-color: rgba(255, 215, 0, 0.3); }
}

.timer-alert-pulse {
  animation: timer-pulse 1s ease-in-out infinite;
  border: 1px solid rgba(255, 215, 0, 0.4);
  border-radius: 1rem;
}
```
  </action>
  <verify>Run `npm run build` — zero errors. Verify all four component files exist in src/components/timer/.</verify>
  <done>TimerPanel renders full and compact variants with single useInterval tick. TimerAlert plays sound on completion and tracks alerted IDs. CSS pulse animation defined. All components compile and build successfully.</done>
</task>

</tasks>

<verification>
- `npm run build` succeeds with zero errors
- Four component files exist: TimerPanel.tsx, TimerCard.tsx, TimerInput.tsx, TimerAlert.tsx
- TimerPanel has both `full` and `compact` variants
- TimerPanel uses a single useInterval for all countdown rendering
- TimerAlert calls playTimerAlert and tracks alerted IDs to prevent re-firing
- index.css has timer-pulse keyframes and .timer-alert-pulse class
- No new dependencies in package.json
</verification>

<success_criteria>
All timer UI components compile and implement the full user interface: preset duration buttons for quick timer creation, countdown display with progress bar, completion alerts with sound, cancel and dismiss actions. Ready for wiring into App.tsx in Plan 03.
</success_criteria>

<output>
After completion, create `.planning/phases/07-timer-system/07-02-SUMMARY.md`
</output>
